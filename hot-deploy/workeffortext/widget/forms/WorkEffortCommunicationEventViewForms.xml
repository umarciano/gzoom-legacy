<?xml version="1.0" encoding="UTF-8"?>

<forms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-form.xsd">
	
	<form name="WorkEffortCommunicationEventViewPortletManagementListForm" id="WECEVPML001_WorkEffortCommunicationEventView" type="list" extends="BasePortletListForm" extends-resource="component://base/widget/PortletForms.xml">
		<field name="workEffortId">
			<hidden/>
		</field>
		<field name="communicationEventId">
			<hidden/>
		</field>
		<field name="entryDate" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_entryDate}">
			<display type="date"/>
		</field>
		<field name="partyIdFrom" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_partyIdFrom}">
			<display-entity entity-name="Party" key-field-name="partyId" description="${partyName}"/>
		</field>
		<field name="partyIdTo" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_partyIdTo}">
			<display-entity entity-name="Party" key-field-name="partyId" description="${partyName}"/>
		</field>
		<field name="subject" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_subject}">
			<display floating-tooltip="${content}"/>
		</field>
		<field name="statusId" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_statusId}">
			<display-entity entity-name="StatusItem"/>
		</field>
	</form>
	
	<form name="WorkEffortCommunicationEventViewManagementListForm" id="WECEVML001_WorkEffortCommunicationEventView" extends="BaseManagementDblClickListForm" extends-resource="component://base/widget/BaseForms.xml">
		<row-actions>
     		<script location="component://workeffortext/webapp/workeffortext/WEB-INF/actions/populateAddressesList.groovy"/>
        </row-actions>
		<field name="workEffortId">
			<hidden/>
		</field>
		<field name="communicationEventId">
			<hidden/>
		</field>
        <field name="contactListId">
			<hidden/>
		</field>
        <field name="backAreaId">
            <hidden value="common-container"/>
        </field>
		<field name="entryDate" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_entryDate}">
			<display type="date"/>
		</field>
		<field name="partyIdFrom" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_partyIdFrom}">
			<display-entity entity-name="Party" key-field-name="partyId" description="${partyName}"/>
		</field>
		<field name="partyIdTo1" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_partyIdTo}1">
			<display-entity entity-name="Party" key-field-name="partyId" description="${partyName}"/>
		</field>
        <field name="subject" sort-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_subject}" widget-area-style="subject-width">
			<display floating-tooltip="${content}"/>
		</field>
	</form>
	
	<form name="WorkEffortCommunicationEventViewManagementForm" id="WECEVM002_WorkEffortCommunicationEventView" extends="BaseManagementForm" extends-resource="component://base/widget/BaseForms.xml">
		<actions>
			<!-- lo script getWorkEffortResponsibleByRole cerca il valore del workEffortId in parameters.workEffortIdFrom -->
            <set field="parameters.workEffortIdFrom" from-field="workEffortId" />
            <script location="component://workeffortext/webapp/workeffortext/WEB-INF/actions/getWorkEffortResponsibleByRole.groovy"/>
     		<script location="component://workeffortext/webapp/workeffortext/WEB-INF/actions/populateAddressesList.groovy"/>
     	</actions>
        <read-only>
            <not>
                <and>
					<if-compare operator="equals" field="insertMode" value="Y"/>
                    <or>
                    	<if-has-permission permission="WORKEFFORTMGR" action="_CREATE"/>
                        <if-has-permission permission="WORKEFFORTMGR" action="_UPDATE"/>
                        <if-has-permission permission="WORKEFFORTORG" action="_ADMIN"/>
                        <if-has-permission permission="WORKEFFORTROLE" action="_ADMIN"/>
                    </or>
                </and>
            </not>
        </read-only>
        <field name="operationalEntityName">
        	<hidden value="WorkEffortCommEvent"/>
        </field>
         <field name="entityName">
            <hidden value="WorkEffortCommunicationEventView"/>
        </field>
        <field name="crudService">
            <hidden value="crudServiceDefaultOrchestration_WorkEffortCommunicationEventView"/>
        </field>
        <field name="workEffortId">
			<hidden/>
		</field>
		<field name="_AUTOMATIC_PK_">
            <hidden value="Y"/>
        </field>
        <field name="communicationEventId">
			<hidden/>
		</field>
		<field name="communicationEventTypeId">
			<hidden value="AUTO_EMAIL_COMM"/>
		</field>
        <field name="statusId">
			<hidden value="COM_IN_PROGRESS"/>
		</field>
        <field name="contentMimeTypeId">
			<hidden value="text/html"/>
		</field>
        <field name="partyIdFrom">
            <hidden value="${userLogin.partyId}"/>
        </field>
        <field required-field="true" name="infoStringFrom" title="${uiLabelMap.WorkEffortCommunicationEventView_partyFromName}" use-when="context.get(&quot;infoStringFrom&quot;) != null">
            <text default-value="${infoStringFrom}"/>
        </field>
        <field required-field="true" name="contactMechIdFrom" title="${uiLabelMap.WorkEffortCommunicationEventView_partyFromName}" use-when="context.get(&quot;infoStringFrom&quot;) == null">
            <drop-down type="drop-list" no-current-selected-key="${defaultContactMechIdFrom}" maxlength="255" size="50" local-autocompleter="true" drop-list-key-field="contactMechId" drop-list-display-field="infoString">
                <list-options list-name="emailAddressesList" description="${infoString}" key-name="contactMechId"/>
            </drop-down>
        </field>
        <field name="contactMechIdTo1" required-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_partyToName}1">
            <drop-down allow-empty="true" no-current-selected-key="${defaultContactMechIdTo1}" local-autocompleter="false" type="drop-list" maxlength="255" size="50" drop-list-key-field="contactMechId" drop-list-display-field="infoString">
                <entity-options key-field-name="contactMechId" description="${infoString}" entity-name="PartyContactWithPurpose">
                	<select-field field-name="contactMechId" display="false"/>
                	<select-field field-name="infoString" display="true"/>
                	<entity-constraint name="contactMechPurposeTypeId" value="PRIMARY_EMAIL"/>
                	<entity-constraint name="contactMechTypeId" value="EMAIL_ADDRESS"/>
                	<entity-order-by field-name="infoString"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="contactMechIdTo2" title="${uiLabelMap.WorkEffortCommunicationEventView_partyToName}2">
            <drop-down allow-empty="true" no-current-selected-key="${defaultContactMechIdTo2}" local-autocompleter="false" type="drop-list" maxlength="255" size="50" drop-list-key-field="contactMechId" drop-list-display-field="infoString">
                <entity-options filter-by-date="true" key-field-name="contactMechId" description="${infoString}" entity-name="PartyContactWithPurpose">
                	<select-field field-name="contactMechId" display="false"/>
                	<select-field field-name="infoString" display="true"/>
                	<entity-constraint name="contactMechPurposeTypeId" value="PRIMARY_EMAIL"/>
                	<entity-constraint name="contactMechTypeId" value="EMAIL_ADDRESS"/>
                	<entity-order-by field-name="infoString"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="contactMechIdTo3" title="${uiLabelMap.WorkEffortCommunicationEventView_partyToName}3">
            <drop-down allow-empty="true" local-autocompleter="false" type="drop-list" maxlength="255" size="50" drop-list-key-field="contactMechId" drop-list-display-field="infoString">
                <entity-options filter-by-date="by-name" key-field-name="contactMechId" description="${infoString}" entity-name="PartyContactWithPurpose">
                	<select-field field-name="contactMechId" display="false"/>
                	<select-field field-name="infoString" display="true"/>
                	<entity-constraint name="contactMechPurposeTypeId" value="PRIMARY_EMAIL"/>
                	<entity-constraint name="contactMechTypeId" value="EMAIL_ADDRESS"/>
                	<entity-order-by field-name="infoString"/>
                </entity-options>
            </drop-down>
        </field>
		<field name="subject" required-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_subject}">
			<text size="50"/>
		</field>
		<field name="content" required-field="true" title="${uiLabelMap.WorkEffortCommunicationEventView_content}">
            <textarea cols="81" rows="20" default-value="${parameters.content}"/>
        </field>
	</form>
	
	<form name="WorkEffortCommunicationEventViewExtendedContextManagementForm" extends="BaseContextExtendedManagementForm" extends-resource="component://base/widget/BaseForms.xml">
        <field name="insertmodeButton" widget-style="buttontext management-insertmode-button" title=" ">
			<!-- aggiunto saveView = Y -->
            <hyperlink link-type="anchor" description="${uiLabelMap.CommonNew}" target="management?oldManagementFormType=${oldManagementFormType}&amp;detail=Y&amp;entityName=${entityName}&amp;parentEntityName=${parentEntityName}&amp;wizard=${parameters.wizard}&amp;insertMode=Y&amp;messageContext=BaseMessageInsert&amp;contextManagement=${contextManagement}&amp;saveView=N&amp;screenNameListIndex=${screenNameListIndex}&amp;folderIndex=${folderIndex}&amp;childManagementDetailTitle=${childManagementDetailTitle}&amp;backAreaId=${backAreaId}&amp;childManagement=${childManagement}&amp;${bsh: import org.ofbiz.base.util.*; return UtilValidate.isNotEmpty(context.get(&quot;managementChildExtraParams&quot;)) ? StringUtil.replaceString(context.get(&quot;managementChildExtraParams&quot;), &quot;|&quot;, &quot;&amp;&quot;) : UtilValidate.isNotEmpty(context.get(&quot;queryString&quot;)) ? StringUtil.replaceString(context.get(&quot;queryString&quot;), &quot;|&quot;, &quot;&amp;&quot;) : UtilValidate.isNotEmpty(parameters.get(&quot;queryString&quot;)) ? StringUtil.replaceString(parameters.get(&quot;queryString&quot;), &quot;|&quot;, &quot;&amp;&quot;) : &quot;&quot;}&amp;${insertExtraParams}" also-hidden="false"/>
            <on-field-event-update-area area-target="${insertAreaTarget}?oldManagementFormType=${oldManagementFormType}&amp;detail=Y&amp;entityName=${entityName}&amp;parentEntityName=${parentEntityName}&amp;wizard=${parameters.wizard}&amp;insertMode=Y&amp;messageContext=BaseMessageInsert&amp;contextManagement=${contextManagement}&amp;saveView=Y&amp;screenNameListIndex=${screenNameListIndex}&amp;folderIndex=${folderIndex}&amp;childManagementDetailTitle=${childManagementDetailTitle}&amp;backAreaId=${backAreaId}&amp;childManagement=${childManagement}&amp;${bsh: import org.ofbiz.base.util.*; return UtilValidate.isNotEmpty(context.get(&quot;managementChildExtraParams&quot;)) ? StringUtil.replaceString(context.get(&quot;managementChildExtraParams&quot;), &quot;|&quot;, &quot;&amp;&quot;) : UtilValidate.isNotEmpty(context.get(&quot;queryString&quot;)) ? StringUtil.replaceString(context.get(&quot;queryString&quot;), &quot;|&quot;, &quot;&amp;&quot;) : UtilValidate.isNotEmpty(parameters.get(&quot;queryString&quot;)) ? StringUtil.replaceString(parameters.get(&quot;queryString&quot;), &quot;|&quot;, &quot;&amp;&quot;) : &quot;&quot;}&amp;${insertExtraParams}" event-type="click" area-id="${insertAreaId}"/>
        </field>
        <field name="saveView">
            <hidden value="N"/>
        </field>        
		<!-- stampa scheda -->
        <field name="printBirtButton" widget-style="buttontext management-print-birt-button" title=" " position="2">
            <hyperlink link-type="anchor" description="${uiLabelMap.CommonPrint}" target="popupWorkEffortLoadPrintBirt?repContextContentId=WE_PRINT&amp;workEffortTypeId=${workEffortTypeId}&amp;workEffortId=${parameters.workEffortIdRoot}&amp;workEffortIdChild=${workEffortId}&amp;weHierarchyTypeId=${parameters.weHierarchyTypeId}&amp;monitoringDate=${parameters.searchDate}&amp;workEffortRevisionId=${parameters.workEffortRevisionId}&amp;saveView=N" target-window="_blank" also-hidden="false"/>
        </field> 
    </form>
    
	<form name="WorkEffortCommunicationEventViewPortletContextForm" extends="ReadOnlyPortletContextManagementForm" extends-resource="component://base/widget/PortletForms.xml">
        <actions>
            <set field="entityName" value="WorkEffortCommunicationEventView"/>
            <set field="managementFormLocation" value="component://workeffortext/widget/forms/WorkEffortCommunicationEventViewForms.xml"/>
            <set field="managementFormType" value=""/>
        </actions>
        <field name="selectedElementButton" id-name="arrayListSelectedElementButton" widget-style="buttontext search-selected-element-button" title=" " position="4">
            <hyperlink link-type="anchor" description="${uiLabelMap.BaseSelectedElement}" target="management?treeViewEntityName=WorkEffortAssocExtView&amp;treeViewLocation=component://workeffortext/widget/trees/WorkEffortRootInqyTrees.xml&amp;treeViewName=WorkEffortRootInqyTree&amp;childManagement=Y&amp;saveView=current&amp;fromPortlet=Y&amp;managementFormType=${managementFormType}&amp;managementFormLocation=${managementFormLocation}&amp;managementFormScreenLocation=${managementFormScreenLocation}&amp;managementScreenName=${managementScreenName}&amp;managementScreenLocation=${managementScreenLocation}&amp;parentEntityName=${parentEntityName}" also-hidden="false"/>
            <on-field-event-update-area area-target="managementContainerOnly" event-type="click" area-id="common-container"/>
        </field>
    </form>
    
    <form name="ListUnknownPartyEmails" id="WEListUnknownPartyEmails_${parameters.weContextId_value}" extends="ListUnknownPartyEmails" extends-resource="component://workeffortext/widget/forms/CommunicationForms.xml">
        <field name="workEffortId">
            <hidden/>
        </field>
    </form>

    <form name="ListPartyCommEvents" paginate-size="20" default-table-style="basic-table list-table padded-row-table hover-bar resizable draggable toggleable customizable headerFixable"  id="WEListPartyCommEvents_${parameters.weContextId_value}" extends="ListPartyCommEvents" extends-resource="component://workeffortext/widget/forms/CommunicationForms.xml">
        <field name="workEffortId">
            <hidden/>
        </field>
    </form>

    <form name="ListDraftEmails" id="WEListDraftEmails_${parameters.weContextId_value}" extends="ListDraftEmails" extends-resource="component://workeffortext/widget/forms/CommunicationForms.xml">
        <field name="workEffortId">
            <hidden/>
        </field>
    </form>

</forms>