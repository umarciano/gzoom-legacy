<?xml version="1.0" encoding="UTF-8"?>
<forms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-form.xsd">

    <form name="WorkEffortRootInqyViewSearchForm" extends="WorkEffortRootInqyViewSearchForm" extends-resource="component://workeffortext/widget/forms/WorkEffortRootInqyViewForms.xml">
        <actions>
            <set field="orderBy" from-field="parameters.orderBy" default-value="sourceReferenceId|workEffortName|weTypeDescription|weStatusDescr|workEffortId"/>
            <set field="weContextId" value="CTX_EP"/>
            <script location="component://workeffortext/webapp/workeffortext/WEB-INF/actions/evaluateCtxTypeParams.groovy"/>
            <script location="component://workeffortext/webapp/workeffortext/WEB-INF/actions/executePerformFindPartyAndPartyParentRoleAndRoleType.groovy"/>
            <script location="component://emplperf/webapp/emplperf/WEB-INF/actions/checkEmplValutatoPermission.groovy"/>
            <script location="component://emplperf/webapp/emplperf/WEB-INF/actions/checkEmplValutatorePermission.groovy"/>
        </actions>
        <field name="weContextId">
            <hidden value="CTX_EP"/>
        </field>
        <field name="rootInqyTree">
        	<hidden value="Y"/>
        </field>
        <!-- ricerca stato Storico -->
        <field name="weStatusDescr" use-when="${bsh: !&quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true}">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="description" drop-list-display-field="description">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusHistoricView" key-field-name="description" description="${description}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="description" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <!-- ricerca non Storico -->
        <field name="weStatusDescr" use-when="${bsh: !&quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (!(&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;)))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true}">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="description" drop-list-display-field="description">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusView" key-field-name="description" description="${description}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="description" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <!-- Stato Attuale solo "Valutazione da Completare" quando read-only (solo per Valutati, non per Valutatori) -->
        <field name="weStatusDescr" use-when="${bsh: !&quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (!(&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;)))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) == true &amp;&amp; context.get(&quot;evalManagerPartyIdReadOnly&quot;) != true}" title="${uiLabelMap.ActualStato}" entry-name="parameters.weStatusDescr">
            <drop-down read-only="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}" type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="description" drop-list-display-field="description">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusView" key-field-name="description" description="${description}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="description" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-constraint name="description" value="Valutazione da Completare"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <!-- ricerca stato Storico -->
        <field name="weStatusDescrLang" use-when="${bsh: &quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true}">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="descriptionLang" drop-list-display-field="descriptionLang">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusHistoricView" key-field-name="descriptionLang" description="${descriptionLang}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="descriptionLang" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <!-- ricerca non Storico -->
        <field name="weStatusDescrLang" use-when="${bsh: &quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (!(&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;)))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true}">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="descriptionLang" drop-list-display-field="descriptionLang">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusView" key-field-name="descriptionLang" description="${descriptionLang}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="descriptionLang" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <!-- Stato Attuale Lang solo "Valutazione da Completare" quando read-only (solo per Valutati, non per Valutatori) -->
        <field name="weStatusDescrLang" use-when="${bsh: &quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (!(&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;)))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) == true &amp;&amp; context.get(&quot;evalManagerPartyIdReadOnly&quot;) != true}" title="${uiLabelMap.CommonStatus}" entry-name="parameters.weStatusDescrLang">
            <drop-down read-only="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}" type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="descriptionLang" drop-list-display-field="descriptionLang">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusView" key-field-name="descriptionLang" description="${descriptionLang}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="descriptionLang" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-constraint name="descriptionLang" value="Valutazione da Completare"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <!-- Stato Attuale normale per Valutatori (tutti gli stati disponibili) -->
        <field name="weStatusDescr" use-when="${bsh: !&quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (!(&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;)))) &amp;&amp; context.get(&quot;evalManagerPartyIdReadOnly&quot;) == true}" title="${uiLabelMap.CommonStatus}" entry-name="parameters.weStatusDescr">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="description" drop-list-display-field="description">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusView" key-field-name="description" description="${description}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="description" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>
        <!-- Stato Attuale Lang normale per Valutatori (tutti gli stati disponibili) -->
        <field name="weStatusDescrLang" use-when="${bsh: &quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) &amp;&amp; (!(&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;)))) &amp;&amp; context.get(&quot;evalManagerPartyIdReadOnly&quot;) == true}" title="${uiLabelMap.CommonStatus}" entry-name="parameters.weStatusDescrLang">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="descriptionLang" drop-list-display-field="descriptionLang">
                <entity-options entity-name="WorkEffortWithTypeAndAllStatusView" key-field-name="descriptionLang" description="${descriptionLang}" distinct="true">
                    <select-field field-name="sequenceId" display="hidden"/>
                    <select-field field-name="descriptionLang" display="true"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="parentTypeId" lookup-for-field-name="weContextId"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>        
        <field name="workEffortTypeId" use-when="${bsh: (&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true}" title="${uiLabelMap.WorkEffortRootType}" entry-name="parameters.workEffortTypeId">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="workEffortTypeId" drop-list-display-field="${workEffortTypeDisplayField}">
                <entity-options entity-name="WorkEffortWithTypeHistoricView" key-field-name="workEffortTypeId" description="${bsh: &quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) ? descriptionLang : description}" distinct="true">
                    <select-field field-name="${workEffortTypeDisplayField}" display="true"/>
                    <select-field field-name="workEffortTypeId"/>
                    <select-field field-name="seqEsp" display="hidden"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="isTemplate" value="N"/>
                    <entity-constraint name="parentTypeId" value="CTX_EP"/>
                    <entity-constraint name="isRootActive" lookup-for-field-name="isRootActive"/>
                    <entity-order-by field-name="seqEsp"/>
                    <entity-order-by field-name="workEffortTypeId"/>
                </entity-options>            
            </drop-down>
        </field>
        <field name="workEffortTypeId" use-when="${bsh: !(&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true}" title="${uiLabelMap.WorkEffortRootType}" entry-name="parameters.workEffortTypeId">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="workEffortTypeId" drop-list-display-field="${workEffortTypeDisplayField}">
                <entity-options entity-name="WorkEffortWithTypeView" key-field-name="workEffortTypeId" description="${bsh: &quot;Y&quot;.equals(context.get(&quot;localeSecondarySet&quot;)) ? descriptionLang : description}" distinct="true">
                    <select-field field-name="${workEffortTypeDisplayField}" display="true"/>
                    <select-field field-name="workEffortTypeId"/>
                    <select-field field-name="seqEsp" display="hidden"/>
                    <entity-constraint name="isRoot" value="Y"/>
                    <entity-constraint name="isTemplate" value="N"/>
                    <entity-constraint name="parentTypeId" value="CTX_EP"/>
                    <entity-constraint name="isRootActive" lookup-for-field-name="isRootActive"/>
                    <entity-order-by field-name="seqEsp"/>
                    <entity-order-by field-name="workEffortTypeId"/>
                </entity-options>            
            </drop-down>
        </field>        
        <!-- Campo evalManagerPartyId read-only per utenti con EMPLVALUTATORE_VIEW -->
        <field name="evalManagerPartyId" use-when="${bsh: context.get(&quot;evalManagerPartyIdReadOnly&quot;) == true}" title="${uiLabelMap.FormFieldTitle_evalManagerPartyId_search}" entry-name="parameters.evalManagerPartyId">
            <drop-down read-only="true" type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="partyId" drop-list-display-field="partyName">
                <entity-options entity-name="PartyRoleView" key-field-name="partyId" description="${partyName} (${parentRoleCode})">
                    <select-field field-name="partyId" display="hidden"/>
                    <select-field field-name="parentRoleCode"/>
                    <select-field field-name="partyName" display="true" description="@{partyName} (@{parentRoleCode})"/>
                    <entity-constraint name="roleTypeId" value="WEM_EVAL_MANAGER"/>
                    <entity-order-by field-name="partyName"/>
                </entity-options>            
            </drop-down>
        </field>
        <!-- Campo evalManagerPartyId normale per utenti senza EMPLVALUTATORE_VIEW -->
        <field name="evalManagerPartyId" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) != true &amp;&amp; context.get(&quot;evalManagerPartyIdReadOnly&quot;) != true}" title="${uiLabelMap.FormFieldTitle_evalManagerPartyId_search}" entry-name="parameters.evalManagerPartyId">
            <drop-down type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="partyId" drop-list-display-field="partyName">
                <entity-options entity-name="PartyRoleView" key-field-name="partyId" description="${partyName} (${parentRoleCode})">
                    <select-field field-name="partyId" display="hidden"/>
                    <select-field field-name="parentRoleCode"/>
                    <select-field field-name="partyName" display="true" description="@{partyName} (@{parentRoleCode})"/>
                    <entity-constraint name="roleTypeId" value="WEM_EVAL_MANAGER"/>
                    <entity-order-by field-name="partyName"/>
                </entity-options>            
            </drop-down>
        </field>
        <field name="evalPartyId" title="${uiLabelMap.FormFieldTitle_evalPartyId_search}" entry-name="parameters.evalPartyId">
            <drop-down read-only="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}" type="drop-list" maxlength="255" size="68" local-autocompleter="false" drop-list-key-field="partyId" drop-list-display-field="partyName">
                <entity-options entity-name="PartyRoleView" key-field-name="partyId" description="${partyName} (${parentRoleCode})">
                    <select-field field-name="partyId" display="hidden"/>
                    <select-field field-name="parentRoleCode"/>
                    <select-field field-name="partyName" display="true" description="@{partyName} (@{parentRoleCode})"/>
                    <entity-constraint name="roleTypeId" value="WEM_EVAL_IN_CHARGE"/>
                    <entity-order-by field-name="partyName"/>
                </entity-options>          
            </drop-down>
        </field> 
        <field name="workEffortRevisionId" use-when="${bsh: (&quot;Y&quot;.equals(context.get(&quot;snapshot&quot;)) || &quot;Y&quot;.equals(parameters.get(&quot;snapshot&quot;))) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true}">
            <drop-down allow-empty="true" current="selected">
                <entity-options entity-name="WorkEffortRevision" description="${description}" key-field-name="workEffortRevisionId">
                    <entity-constraint name="isAutomatic" value="N"/>
                    <entity-constraint name="workEffortTypeIdCtx" value="CTX_EP"/>
                    <entity-order-by field-name="description"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="group_WorkEffortRole_sep">
            <ignored/>
        </field>
        <field name="group_WorkEffortRole">
            <ignored/>
        </field>
        <field name="weResponsibleRoleTypeId">
            <ignored/>
        </field>
        <field name="weResponsiblePartyId">
            <ignored/>
        </field>
        <field name="currentStatusId">
            <ignored/>
        </field>
        <field name="childStruct" use-when="${bsh: import org.ofbiz.base.util.UtilValidate; return (security.hasPermission(&quot;EMPLPERFMGR_ADMIN&quot;, userLogin) &amp;&amp; context.get(&quot;evalPartyIdReadOnly&quot;) != true)}">
            <drop-down type="drop-down" allow-empty="false" no-current-selected-key="N" current="selected">
                <option key="Y" description="${uiLabelMap.CommonYes}"/>
                <option key="N" description="${uiLabelMap.CommonNo}"/>
            </drop-down>
        </field>
        
        <!-- Override dei campi ereditati dal form padre per nasconderli quando evalPartyIdReadOnly è true -->
        <field name="isRootActive" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="organizationId" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="orgUnitRoleTypeId" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="orgUnitId" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="responsibleRoleTypeId" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="responsiblePartyId" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="sourceReferenceId" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="sourceReferenceId" use-when="${bsh: context.get(&quot;evalManagerPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="workEffortName" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="workEffortNameLang" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        
        <field name="defaultSearchDate" use-when="${bsh: context.get(&quot;evalPartyIdReadOnly&quot;) == true}">
            <ignored/>
        </field>
        <sort-order>
        	<sort-field name="isRootActive"/>
            <sort-field name="organizationId"/>
            <sort-field name="group_OrgUnit_sep"/>
            <sort-field name="group_OrgUnit"/>
            <sort-field name="childStruct"/>
            <sort-field name="orgUnitRoleTypeId"/>
            <sort-field name="orgUnitId"/>
            <sort-field name="responsibleRoleTypeId"/>
            <sort-field name="responsiblePartyId"/>
            <sort-field name="group_WorkEffortRole_sep"/>
            <sort-field name="group_WorkEffortRole"/>            
            <sort-field name="weResponsibleRoleTypeId"/>
            <sort-field name="weResponsiblePartyId"/>
            <sort-field name="group_Others_sep"/>
            <sort-field name="group_Others"/>
            <sort-field name="weStatusDescr"/>
            <sort-field name="weStatusDescrLang"/>
            <sort-field name="workEffortTypeId"/>
            <sort-field name="sourceReferenceId"/>
            <sort-field name="workEffortName"/>
            <sort-field name="workEffortNameLang"/>
            <sort-field name="weActivation"/>
            <sort-field name="workEffortRevisionId"/>
            <sort-field name="searchDate"/>
            <sort-field name="evalManagerPartyId"/>
            <sort-field name="evalPartyId"/>
        </sort-order>
    </form>
    
    <form name="WorkEffortRootInqyViewAdvancedSearchForm" extends="WorkEffortRootInqyViewAdvancedSearchForm" extends-resource="component://workeffortext/widget/forms/WorkEffortRootInqyViewForms.xml">
    </form>
</forms>
